import{Preview as PreviewUtility}from"../preview";import PaletteSelector from"../color/palette-selector";const api=wp.customize,colorLib=window.net.brehaut;export class LinkPreview{constructor(){this.previewUtility=new PreviewUtility,this.paletteSelector=new PaletteSelector,this.prefixes=["bgtfw_body","bgtfw_footer","bgtfw_posts_date","bgtfw_posts_byline","bgtfw_posts_tags","bgtfw_posts_cats","bgtfw_posts_navigation","bgtfw_blog_post_header_byline","bgtfw_blog_post_header_date","bgtfw_blog_post_cats","bgtfw_blog_post_tags","bgtfw_blog_post_comments","bgtfw_blog_post_readmore"],this.selectors={}}bindEvents(){$(()=>{let t=this.prefixes;for(let o of t){this.selectors[o]=this.getSelectors(o);let t=[`${o}_link_color`,`${o}_link_color_hover`,`${o}_link_decoration`,`${o}_link_decoration_hover`];"bgtfw_body"!==o&&t.push(`${o}_link_color_display`),"bgtfw_footer"===o&&(t=[`${o}_link_color`]),api(...t,(...t)=>{t.map(t=>t.bind(()=>this.updateStyles(o)))})}})}getSelectors(t){let o=[];return parent.wp.customize.control&&parent.wp.customize.control(`${t}_link_color`)&&(o=parent.wp.customize.control(`${t}_link_color`).params.choices.selectors),o}updateStyles(t){let o="";if(!1===_.isFunction(api(`${t}_link_color_display`))||"inherit"!==api(`${t}_link_color_display`)()){let e,r,i,l,_,n,s;"bgtfw_footer"===t?(e=this._getColor(`${t}_link_color`,!0),r=api("bgtfw_body_link_color_hover")()||0,i=this._getDecoration("bgtfw_body_link_decoration"),l=this._getDecoration("bgtfw_body_link_decoration_hover"),_="",n=this.selectors[t]):(e=this._getColor(`${t}_link_color`,!0),r=api(`${t}_link_color_hover`)()||0,i=this._getDecoration(`${t}_link_decoration`),l=this._getDecoration(`${t}_link_decoration_hover`),_="",n=this.selectors[t]),r=parseInt(r,10)/100,s=colorLib.Color(e).lightenByAmount(r).toCSS();for(let t of n)o+=`\n\t\t\t\t\t${t+=_} {\n\t\t\t\t\t\tcolor: ${e};\n\t\t\t\t\t\ttext-decoration: ${i};\n\t\t\t\t\t}\n\t\t\t\t\t${t}:hover,\n\t\t\t\t\t${t}:focus {\n\t\t\t\t\t\tcolor: ${s} !important;\n\t\t\t\t\t\ttext-decoration: ${l};\n\t\t\t\t\t}\n\t\t\t\t`;if("bgtfw_body"===t){let t=api("boldgrid_color_palette")(),e=(t=t?JSON.parse(api("boldgrid_color_palette")()):parent.BOLDGRID.COLOR_PALETTE.Modify).state.palettes["palette-primary"].colors,r=t.state.palettes["palette-primary"]["neutral-color"];[1,2,3,4,5,"neutral"].map(t=>{var i,l="neutral"===t?r:e[t-1],_=api("bgtfw_body_link_color_hover")()||0;_=parseInt(_,10)/100,i=colorLib.Color(l).lightenByAmount(_).toCSS(),o+=`.sidebar.color-${t}-link-color a:not( .btn ):hover, .sidebar.color-${t}-link-color a:not( .btn ):focus { color: ${i} !important; }`}),this.updateStyles("bgtfw_footer")}}let e=t.replace(/_/g,"-");this.previewUtility.updateDynamicStyles(`${e}-link-inline-css`,o)}_getDecoration(t){return api(t)()}_getColor(t,o=!1){let e=api(t)()||"";return this.paletteSelector.getColor(e,o)}}