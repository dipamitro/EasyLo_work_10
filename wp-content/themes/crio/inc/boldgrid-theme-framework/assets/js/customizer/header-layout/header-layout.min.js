const controlApi=parent.wp.customize,underscore=parent.window._;parent.window.BOLDGRID.colWidthSliders=parent.window.BOLDGRID.colWidthSliders?parent.window.BOLDGRID.colWidthSliders:{};const colWidthSliders=parent.window.BOLDGRID.colWidthSliders;export class HeaderLayout{init(){this.socialMenuId=controlApi("nav_menu_locations[social]")(),this.changeColumnDevice(),this.bindExpanding(),this.bindControlChanges(),this.bindResizeEvents(),wp.customize.bind("preview-ready",()=>{this.correctMenuLocations(),wp.customize.preview.bind("sendHeaderLayout",e=>{this.renderHeaderPreview(...e)})}),parent.window.BOLDGRID.colWidths=parent.window.BOLDGRID.colWidths?parent.window.BOLDGRID.colWidths:this}correctMenuLocations(){var e,t,o=controlApi("nav_menu_locations[footer-social]")(),i=controlApi("nav_menu_locations[main]")(),n=controlApi("nav_menu_locations[social]")(),r=controlApi("bgtfw_footer_layout")();window._.isFunction(controlApi("nav_menu_locations[sticky-social]"))&&(e=controlApi("nav_menu_locations[sticky-social]")()),window._.isFunction(controlApi("nav_menu_locations[sticky-main]"))&&(t=controlApi("nav_menu_locations[sticky-main]")()),0===o&&controlApi.control("nav_menu_locations[footer-social]").setting.set(n),0!==t&&0!==e||(controlApi.control("nav_menu_locations[sticky-main]").setting.set(i),controlApi.control("nav_menu_locations[sticky-social]").setting.set(n)),r.forEach(e=>{e.items.forEach(e=>{"boldgrid_menu_social"===e.type&&(e.type="boldgrid_menu_footer-social")})})}bindFullWidth(){var e=controlApi("bgtfw_header_layout_custom_col_width")(),t=controlApi.control("bgtfw_header_layout_custom_col_width").container;t.find(".col-width-full-width").each((t,o)=>{var i,n=o.dataset.device,r=o.dataset.row;i=e&&"fullWidth"in e&&void 0!==e.fullWidth[r]?e.fullWidth[r][n]:"tablet"===n||"phone"===n,controlApi.control("bgtfw_header_layout_custom_col_width").container.find(o).prop("checked",i)}),t.find(".col-width-full-width").off("click").on("click",e=>{var t=parent.window.BOLDGRID.colWidths.getDeviceClass($(e.currentTarget).data("device"));$(e.currentTarget).prop("checked")?$(e.currentTarget).parent().addClass("disabled"):$(e.currentTarget).parent().removeClass("disabled"),parent.window.BOLDGRID.colWidths.updateControlValue(),$(e.currentTarget).parent().siblings(".col-width-slider").data("items").forEach(e=>{$("."+e.uid).toggleClass(t+"full-width")})})}bindResizeEvents(){controlApi.bind("preview-ready",()=>{$(window).on("resize",_.debounce(()=>{controlApi.control("bgtfw_header_layout_custom_col_width").container.find(".col-width-slider").children().remove(),this.initialColumnSliders()},300))})}changeColumnDevice(){var e=controlApi.control("bgtfw_header_layout_custom_col_width").container;e.find(".devices-wrapper label").on("click",t=>{var o=$(t.currentTarget).siblings("input").val();e.find(".col-width-slider-device-group").height(0);let i=e.find("#bgtfw_header_layout_custom_col_width-slider-"+o).find(".col-width-slider").length;e.find("#bgtfw_header_layout_custom_col_width-slider-"+o).height(100*i),"phone"===o?e.closest("body").find("button.preview-mobile").not(".active").trigger("click"):e.closest("body").find("button.preview-"+o).not(".active").trigger("click")})}updateSliderControl(e){$.ajax(wp.ajax.settings.url,{type:"POST",context:this,data:{action:"bgtfw_header_columns",headerColumnsNonce:controlApi.settings.nonce["bgtfw-header-columns"],wpCustomize:"on",customizeTheme:controlApi.settings.theme.stylesheet,customHeaderLayout:e}}).done(e=>{var t=controlApi.control("bgtfw_header_layout_custom_col_width").container;t.find(".col-width-slider-device-group").remove(),t.find(".sliders-wrapper").html(e.data.markup),this.initialColumnSliders(!0),this.updateControlValue(),t.css("opacity",1)})}initialColumnSliders(e=!1){var t=controlApi.control("bgtfw_header_layout_custom_col_width").container,o=t.find(".col-width-slider"),i=controlApi("bgtfw_header_layout_custom_col_width")();o.each((o,n)=>{var r=$(n).data("items"),a=[];r.forEach((t,o)=>{var r=parseInt(t.width);if(!e&&i&&i[t.uid]&&i[t.uid][t.device]&&(r=parseInt(i[t.uid]&&i[t.uid][t.device])),0===o)a.push(0,r);else{let e=a[a.length-1],t=e+r;a.push(e,t)}colWidthSliders[t.uid]?(colWidthSliders[t.uid].row=n.dataset.row,colWidthSliders[t.uid].col=o,colWidthSliders[t.uid].key=t.key):colWidthSliders[t.uid]={row:n.dataset.row,col:o,key:t.key}});let d=t.find(n).multiSlider({min:0,max:12,step:1,total:r.length,values:a,create:this.bindFullWidth,stop:this.bindSliderChanges}),s=t.find(d.element);s.find(".ui-slider-range").each((e,o)=>{var i=r[e].uid,n=r[e].device;!!s.siblings(".full-width-wrapper").children("input").attr("checked")?s.siblings(".full-width-wrapper").children("input").parent().addClass("disabled"):s.siblings(".full-width-wrapper").children("input").parent().removeClass("disabled"),t.find(o).parent().attr({"data-uid":i,"data-device":n}),t.find(o).html('<span class="col-width-range-label">'+r[e].key+"</span>"),colWidthSliders[i]||(colWidthSliders[i]={}),colWidthSliders[i][n]=d});let c=controlApi.control("bgtfw_header_layout_custom_col_width").container.find(".devices-wrapper input:checked").val();controlApi.control("bgtfw_header_layout_custom_col_width").container.find(".col-width-slider-device-group").not("#bgtfw_header_layout_custom_col_width-slider-"+c).height(0)})}getDeviceClass(e){var t="col-lg-";switch(e){case"large":t="col-lg-";break;case"desktop":t="col-md-";break;case"tablet":t="col-sm-";break;case"phone":t="col-xs-"}return t}updateControlValue(){var e=colWidthSliders,t={},o=controlApi.control("bgtfw_header_layout_custom_col_width").container.find(".col-width-full-width");for(const o in e){t[o]={};for(const i in e[o]){if("col"===i||"row"===i||"key"===i)continue;let n=e[o][i].option("values"),r=2*(e[o].col+1)-1,a=r-1;t[o][i]=n[r]-n[a]}}t.fullWidth=[],o.each((e,o)=>{var i=controlApi.control("bgtfw_header_layout_custom_col_width").container.find(o),n=i.data("device"),r=!!i.prop("checked"),a=parseInt(i.data("row"));t.fullWidth[a]||(t.fullWidth[a]={}),t.fullWidth[a][n]=r}),controlApi.control("bgtfw_header_layout_custom_col_width").setting.set(t)}bindSliderChanges(e,t){var o=parseInt(t.values[1])-parseInt(t.values[0]),i=e.target.dataset.uid,n=e.target.dataset.device,r=parent.window.BOLDGRID.colWidths.getDeviceClass(n);$("."+i)[0].classList.forEach(e=>{e.includes(r)&&$("."+i).removeClass(e)}),$("."+i).addClass(r+o),parent.window.BOLDGRID.colWidths.updateControlValue()}bindExpanding(){controlApi.section(controlApi.control("bgtfw_header_layout_custom").section()).expanded.bind(()=>{this.initialColumnSliders(),"custom"===controlApi("bgtfw_header_preset")()?controlApi.control("bgtfw_header_layout_custom").activate():controlApi.control("bgtfw_header_layout_custom").deactivate(),controlApi.control("bgtfw_header_layout_custom_col_width").container.closest("body").find("#customize-footer-actions button").on("click",e=>{var t=e.currentTarget.dataset.device;controlApi.control("bgtfw_header_layout_custom_col_width").container.find(".devices").each((e,o)=>{t===controlApi.control("bgtfw_header_layout_custom_col_width").container.find(o).data("device")&&controlApi.control("bgtfw_header_layout_custom_col_width").container.find(o).trigger("click")})}),controlApi.control("bgtfw_header_width").container.find("input[type=range]").on("change",e=>{var t=e.currentTarget.value;controlApi.control("bgtfw_header_width").container.find("span.value input").val(t),controlApi.control("bgtfw_header_width").container.find("span.value input").html(t)})}),controlApi.panel("bgtfw_header_layouts").expanded.bind(e=>{e&&"custom"===controlApi("bgtfw_header_preset")()?controlApi.section("bgtfw_header_layout_advanced").activate():e&&"custom"!==controlApi("bgtfw_header_preset")()&&controlApi.section("bgtfw_header_layout_advanced").deactivate()}),controlApi.section("title_tagline").expanded.bind(e=>{e&&this.brandingNotices(controlApi("bgtfw_header_preset_branding")(),controlApi.control("custom_logo"))}),controlApi("custom_logo",e=>{e.bind(()=>{this.brandingNotices(controlApi("bgtfw_header_preset_branding")(),controlApi.control("custom_logo"))})}),controlApi.section("bgtfw_header_presets").expanded.bind(e=>{e&&(this.brandingNotices(controlApi("bgtfw_header_preset_branding")(),controlApi.control("bgtfw_header_preset_branding")),controlApi.control("bgtfw_header_preset").container.find(".bgtfw_header_presetcustom").on("click",()=>{controlApi.section("bgtfw_header_layout_advanced").activate(),underscore.defer(()=>{controlApi.control("bgtfw_header_layout_position").focus()})})),e||"custom"!==controlApi("bgtfw_header_preset")()?e||"custom"===controlApi("bgtfw_header_preset")()||controlApi.section("bgtfw_header_layout_advanced").deactivate():controlApi.section("bgtfw_header_layout_advanced").activate()})}maybeUpdateSlider(e,t){if(e.length>t.length)return!0;for(let o=0;o<e.length;o++)for(let i=0;i<t[o].items.length;i++)if(e[o].items.length!==t[o].items.length&&"sidebar"===t[o].items[i].key){controlApi.previewer.refresh();break}if(e===t)return!1;if(e.length<t.length)return!0;for(let o=0;o<e.length;o++){if(e[o].items.length!==t[o].items.length)return!0;for(let i=0;i<e[o].items.length;i++)if(e[o].items[i].uid!==t[o].items[i].uid)return!0}return!1}renderHeaderPreview(e,t,o){var i;$(e).find(".boldgrid-section").remove(),$(e).append(t),i=this.getHiddenItems(o),$("#sticky-header-display-inline-css").remove(),this.hideHiddenItems(i)}customPageHeader(){return 0!==$("#masthead.template-header").length}bindControlChanges(){var e="nav_menu["+this.socialMenuId+"]";controlApi.bind("add",t=>{window._.isFunction(t.section)&&e===t.section()&&(t.setting.transport="refresh")}),controlApi("bgtfw_header_layout_custom",e=>{e.bind((e,t)=>{var o=this.maybeUpdateSlider(t,e);o&&controlApi.control("bgtfw_header_layout_custom_col_width").container.css("opacity",.1),$.ajax(wp.ajax.settings.url,{type:"POST",context:this,data:{action:"bgtfw_header_preset",headerPresetNonce:controlApi.settings.nonce["bgtfw-header-preset"],wpCustomize:"on",customizeTheme:controlApi.settings.theme.stylesheet,headerPreset:"custom",customHeaderLayout:e,columnWidths:controlApi("bgtfw_header_layout_custom_col_width")()}}).done(t=>{var i={};t.data.markup&&($("#masthead").find(".boldgrid-section").remove(),$("#masthead").append(t.data.markup),i=this.getHiddenItems(e),$("#sticky-header-display-inline-css").remove(),this.hideHiddenItems(i),o&&this.updateSliderControl(e),window.BOLDGRID.CustomizerEdit._onLoad())})})}),controlApi("bgtfw_sticky_header_layout_custom",e=>{e.bind(e=>{$.ajax(wp.ajax.settings.url,{type:"POST",context:this,data:{action:"bgtfw_header_preset",headerPresetNonce:controlApi.settings.nonce["bgtfw-header-preset"],wpCustomize:"on",customizeTheme:controlApi.settings.theme.stylesheet,stickyHeaderPreset:"custom",customHeaderLayout:e}}).done(t=>{var o={};t.data.markup&&($("#masthead-sticky").find(".boldgrid-section").remove(),$("#masthead-sticky").append(t.data.markup),o=this.getHiddenItems(e),$("#sticky-header-display-inline-css").remove(),this.hideHiddenItems(o))})})}),controlApi("bgtfw_header_layout_position",e=>{"header-top"===controlApi("bgtfw_header_layout_position")()?$(".bgtfw-sticky-header").show():$(".bgtfw-sticky-header").hide(),e.bind(e=>{$("body").removeClass("header-left header-right header-top"),$("body").addClass(e),"header-top"===e?$(".bgtfw-sticky-header").show():(controlApi("bgtfw_header_width",controlApi("bgtfw_header_width")()),$(".bgtfw-sticky-header").hide())})}),controlApi("bgtfw_header_preset",e=>{e.bind(t=>{var o={action:"bgtfw_header_preset",headerPresetNonce:controlApi.settings.nonce["bgtfw-header-preset"],wpCustomize:"on",customizeTheme:controlApi.settings.theme.stylesheet,headerPreset:t,hasLogoSet:!!controlApi("custom_logo")};"custom"===t&&(o.customHeaderLayout=controlApi("bgtfw_header_layout_custom")(),controlApi.section("bgtfw_header_layout_advanced").activate()),this.customPageHeader()?e.notifications.add("customPageHeader",new controlApi.Notification("customPageHeader",{type:"warning",message:"The page that you are previewing is using a Custom Page Header. Changes made will still be saved, but will not be previewed on this page."})):(e.notifications.remove("customPageHeader"),$("#masthead").css("opacity",.1),$.ajax(wp.ajax.settings.url,{type:"POST",data:o,context:this}).done(e=>{var o={};e.data.markup&&("lshsbm"===t?controlApi.control("bgtfw_header_layout_position").setting("header-left"):"header-left"===controlApi("bgtfw_header_layout_position")()&&controlApi.control("bgtfw_header_layout_position").setting("header-top"),controlApi.control("bgtfw_header_layout").setting(e.data.layout),$("#masthead").find(".boldgrid-section").remove(),$("#masthead").append(e.data.markup),o=this.getHiddenItems(e.data.layout),$("#sticky-header-display-inline-css").remove(),this.hideHiddenItems(o),this.setupCurrentMenuItem("main-menu"),$("#masthead").css("opacity",1),window.BOLDGRID.CustomizerEdit._onLoad())}))})}),controlApi("bgtfw_sticky_header_preset",e=>{e.bind(e=>{var t={action:"bgtfw_header_preset",headerPresetNonce:controlApi.settings.nonce["bgtfw-header-preset"],wpCustomize:"on",customizeTheme:controlApi.settings.theme.stylesheet,stickyHeaderPreset:e};"custom"===e&&(controlApi.section("bgtfw_sticky_header_layout_advanced").activate(),underscore.defer(()=>{controlApi.control("bgtfw_sticky_header_layout_custom").focus()}),t.customHeaderLayout=controlApi("bgtfw_sticky_header_layout_custom")()),$("#masthead-sticky").css("opacity",.1),$.ajax(wp.ajax.settings.url,{type:"POST",data:t,context:this}).done(e=>{var t={};e.data.markup&&($("#masthead-sticky").find(".boldgrid-section").remove(),$("#masthead-sticky").append(e.data.markup),$("#sticky-header-display-inline-css").remove(),controlApi.control("bgtfw_sticky_header_layout").setting(e.data.layout),t=this.getHiddenItems(e.data.layout),this.hideHiddenItems(t),this.setupCurrentMenuItem("sticky-main-menu"),$("#masthead-sticky").css("opacity",1))})})}),controlApi("bgtfw_header_preset_branding",e=>{e.bind(e=>{var t=["logo","title","description"],o=[];"default"!==controlApi("bgtfw_header_preset")&&"custom"!==controlApi("bgtfw_header_preset")&&($("#sticky-header-display-inline-css").remove(),e.forEach(i=>{var n=t.indexOf(i);-1<n&&(t.splice(n,1),o.push(i)),this.brandingNotices(e,controlApi.control("bgtfw_header_preset_branding"))}),o.forEach(e=>{$("#masthead .site-branding").removeClass("hide-"+e),$("#masthead .site-branding").children().removeClass("invisible"),$("#masthead .site-branding .site-description").show()}),t.forEach(e=>{$("#masthead .site-branding").addClass("hide-"+e)}),window.BOLDGRID.CustomizerEdit._onLoad())})}),controlApi("blogdescription",e=>{e.bind(()=>{_.defer(window.BOLDGRID.CustomizerEdit._onLoad)})}),controlApi("bgtfw_sticky_header_preset_branding",e=>{e.bind(e=>{var t=["logo","title","description"],o=[];"default"!==controlApi("bgtfw_sticky_header_preset")&&"custom"!==controlApi("bgtfw_sticky_header_preset")&&($("#sticky-header-display-inline-css").remove(),e.forEach(i=>{var n=t.indexOf(i);-1<n&&(t.splice(n,1),o.push(i)),this.brandingNotices(e,controlApi.control("bgtfw_sticky_header_preset_branding"))}),o.forEach(e=>{$("#masthead-sticky .site-branding").removeClass("hide-"+e)}),t.forEach(e=>{$("#masthead-sticky .site-branding").addClass("hide-"+e)}))})})}brandingNotices(e,t){var o=t.container,i=t.id;o.find(".branding_notice").hide(),e.includes("logo")&&!controlApi("custom_logo")()&&(o.find(".branding_notice.logo").show(),o.find(".branding_notice.logo a").on("click",e=>{e.preventDefault(),controlApi.control("custom_logo").focus()})),e.includes("title")&&!controlApi("blogname")()&&(o.find(".branding_notice.title").show(),o.find(".branding_notice.title a").on("click",e=>{e.preventDefault(),controlApi.control("title").focus()})),e.includes("description")&&!controlApi("blogdescription")()&&(o.find(".branding_notice.description").show(),o.find(".branding_notice.description a").on("click",e=>{e.preventDefault(),controlApi.control("blogdescription").focus()})),"custom_logo"===i&&!e.includes("logo")&&controlApi("custom_logo")()&&(o.find(".branding_notice.logo_set").show(),o.find(".branding_notice.logo_set a").off("click"),o.find(".branding_notice.logo_set a").on("click",e=>{e.preventDefault(),controlApi.control("bgtfw_header_preset_branding").focus()}))}setupCurrentMenuItem(e){var t=$(location).attr("href").split("?")[0];$("#"+e+" > li").children("a").each((e,o)=>{$(o).attr("href")===t&&$(o).parent().addClass("current-menu-item current_page_item")})}getHiddenItems(e){var t={};return(Array.isArray(e)?e:[]).forEach(e=>{e.items.forEach(e=>{var o,i=[];"branding"===e.key&&(o=e.uid,e.display.forEach(e=>{"hide"===e.display&&".custom-logo"===e.selector?i.push(".custom-logo-link"):"hide"===e.display&&i.push(e.selector)})),o&&i&&(t[o]=i)})}),t}hideHiddenItems(e){if("default"!==controlApi("bgtfw_header_preset")()&&"custom"!==controlApi("bgtfw_header_preset")())return;let t=t=>{e[t].forEach(e=>{".site-description"===e&&$("."+t).find(".site-description").addClass("invisible"),$("."+t).find(".site-branding").find(e).hide()})};for(const o in e)$("."+o).find(".site-branding").children().show(),$("."+o).find(".site-description").removeClass("invisible"),t(o)}}export default HeaderLayout;